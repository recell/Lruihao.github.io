<!doctype html><html lang="en"><head><meta charset="UTF-8"><title>推箱子</title><link rel="icon" href="/images/favicon-32x32-next.png" type="image/x-icon"><style>*{margin:0;padding:0}.game{width:560px;margin:5px auto}</style></head><body onkeydown="doKeyDown(event)" bgcolor="gray"><button><a href="/games">返回游戏馆</a></button><div class="game"><canvas id="canvas" width="560" height="560"></canvas><div id="msg"></div><input type="button" value="上一关" onclick="NextLevel(-1)"> <input type="button" value="下一关" onclick="NextLevel(1)"> <input type="button" value="重玩本关" onclick="NextLevel(0)"> <input type="button" value="游戏说明" onclick="showHelp()"></div><script src="/js/games/mapdata100.js"></script><script>var curMap,curLevel,curMan,block,wall,box,ball,up,down,left,right,can=document.getElementById("canvas"),msg=document.getElementById("msg"),cxt=can.getContext("2d"),w=35,h=35,iCurlevel=0,moveTimes=0,oImgs={block:"/images/pullbox/block.gif",wall:"/images/pullbox/wall.png",box:"/images/pullbox/box.png",ball:"/images/pullbox/ball.png",up:"/images/pullbox/up.png",down:"/images/pullbox/down.png",left:"/images/pullbox/left.png",right:"/images/pullbox/right.png"};function imgPreload(e,o){var n=0,r=0,i={};for(src in e)r++;for(src in e)i[src]=new Image,i[src].onload=function(){++n>=r&&o(i)},i[src].src=e[src]}function init(){initLevel(),showMoveInfo()}function InitMap(){for(var e=0;e<16;e++)for(var o=0;o<16;o++)cxt.drawImage(block,w*o,h*e,w,h)}function Point(e,o){this.x=e,this.y=o}imgPreload(oImgs,function(e){block=e.block,wall=e.wall,box=e.box,ball=e.ball,up=e.up,down=e.down,left=e.left,right=e.right,init()});var perPosition=new Point(5,5);function DrawMap(e){for(var o=0;o<e.length;o++)for(var n=0;n<e[o].length;n++){var r=block;switch(e[o][n]){case 1:r=wall;break;case 2:r=ball;break;case 3:r=box;break;case 4:r=curMan,perPosition.x=o,perPosition.y=n;break;case 5:r=box}cxt.drawImage(r,w*n-(r.width-w)/2,h*o-(r.height-h),r.width,r.height)}}function initLevel(){curMap=copyArray(levels[iCurlevel]),curLevel=levels[iCurlevel],curMan=down,InitMap(),DrawMap(curMap)}function NextLevel(e){if((iCurlevel+=e)<0)iCurlevel=0;else{var o=levels.length;o-1<iCurlevel&&(iCurlevel=o-1),initLevel(),moveTimes=0,showMoveInfo()}}function go(e){var o,n;switch(e){case"up":curMan=up,o=new Point(perPosition.x-1,perPosition.y),n=new Point(perPosition.x-2,perPosition.y);break;case"down":curMan=down,o=new Point(perPosition.x+1,perPosition.y),n=new Point(perPosition.x+2,perPosition.y);break;case"left":curMan=left,o=new Point(perPosition.x,perPosition.y-1),n=new Point(perPosition.x,perPosition.y-2);break;case"right":curMan=right,o=new Point(perPosition.x,perPosition.y+1),n=new Point(perPosition.x,perPosition.y+2)}Trygo(o,n)&&(moveTimes++,showMoveInfo()),InitMap(),DrawMap(curMap),checkFinish()&&(alert("恭喜过关！！"),NextLevel(1))}function checkFinish(){for(var e=0;e<curMap.length;e++)for(var o=0;o<curMap[e].length;o++)if(2==curLevel[e][o]&&3!=curMap[e][o]||5==curLevel[e][o]&&3!=curMap[e][o])return!1;return!0}function Trygo(e,o){if(e.x<0)return!1;if(e.y<0)return!1;if(e.x>curMap.length)return!1;if(e.y>curMap[0].length)return!1;if(1==curMap[e.x][e.y])return!1;if(3==curMap[e.x][e.y]||5==curMap[e.x][e.y]){if(1==curMap[o.x][o.y]||3==curMap[o.x][o.y])return!1;curMap[o.x][o.y]=3}curMap[e.x][e.y]=4;var n=curLevel[perPosition.x][perPosition.y];return 2!=n&&(n=5==n?2:0),curMap[perPosition.x][perPosition.y]=n,perPosition=e,!0}function doKeyDown(e){switch(e.keyCode){case 37:go("left");break;case 38:go("up");break;case 39:go("right");break;case 40:go("down")}}function showMoveInfo(){msg.innerHTML="第"+(iCurlevel+1)+"关 移动次数: "+moveTimes}var showhelp=!1;function showHelp(){(showhelp=!showhelp)?msg.innerHTML="用键盘上的上、下、左、右键移动小人，把箱子全部推到小球的位置即可过关。箱子只可向前推，不能往后拉，并且小人一次只能推动一个箱子。":showMoveInfo()}function copyArray(e){for(var o=[],n=0;n<e.length;n++)o[n]=e[n].concat();return o}</script></body></html>