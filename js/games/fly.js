(function(t){var e=t.Sakri||{};t.Sakri=t.Sakri||e;e.MathUtil={};e.MathUtil.PI_180=Math.PI/180;e.MathUtil.ONE80_PI=180/Math.PI;e.MathUtil.PI2=Math.PI*2;e.MathUtil.HALF_PI=Math.PI/2;e.MathUtil.normalize=function(t,e,a){return(t-e)/(a-e)};e.MathUtil.interpolate=function(t,e,a){return e+(a-e)*t};e.MathUtil.map=function(t,a,r,n,i){return e.MathUtil.interpolate(e.MathUtil.normalize(t,a,r),n,i)};e.MathUtil.getRandomNumberInRange=function(t,e){return t+Math.random()*(e-t)};e.MathUtil.getRandomIntegerInRange=function(t,a){return Math.round(e.MathUtil.getRandomNumberInRange(t,a))}})(window);(function(t){var e=t.Sakri||{};t.Sakri=t.Sakri||e;e.Geom={};e.Geom.Point=function(t,e){this.x=isNaN(t)?0:t;this.y=isNaN(e)?0:e};e.Geom.Point.prototype.clone=function(){return new e.Geom.Point(this.x,this.y)};e.Geom.Point.prototype.update=function(t,e){this.x=isNaN(t)?this.x:t;this.y=isNaN(e)?this.y:e};e.Geom.Point.prototype.equals=function(t){return this.x==t.x&&this.y==t.y};e.Geom.Point.prototype.toString=function(){return"{x:"+this.x+" , y:"+this.y+"}"};e.Geom.Rectangle=function(t,e,a,r){this.update(t,e,a,r)};e.Geom.Rectangle.prototype.update=function(t,e,a,r){this.x=isNaN(t)?0:t;this.y=isNaN(e)?0:e;this.width=isNaN(a)?0:a;this.height=isNaN(r)?0:r};e.Geom.Rectangle.prototype.getRight=function(){return this.x+this.width};e.Geom.Rectangle.prototype.getBottom=function(){return this.y+this.height};e.Geom.Rectangle.prototype.getCenterX=function(){return this.x+this.width/2};e.Geom.Rectangle.prototype.getCenterY=function(){return this.y+this.height/2};e.Geom.Rectangle.prototype.containsPoint=function(t,e){return t>=this.x&&e>=this.y&&t<=this.getRight()&&e<=this.getBottom()};e.Geom.Rectangle.prototype.clone=function(){return new e.Geom.Rectangle(this.x,this.y,this.width,this.height)};e.Geom.Rectangle.prototype.toString=function(){return"Rectangle{x:"+this.x+" , y:"+this.y+" , width:"+this.width+" , height:"+this.height+"}"}})(window);(function(t){var e=t.Sakri||{};t.Sakri=t.Sakri||e;e.CanvasTextUtil={};e.CanvasTextUtil.getFontSizeForRect=function(t,e,a,r,n){if(!r){var r=document.createElement("canvas")}if(!n){n="#000000"}var i=r.getContext("2d");i.font=e.getFontString();i.textBaseline="top";var o=e.clone();i.font=o.getFontString();var s=i.measureText(t).width;if(s<a.width){while(i.measureText(t).width<a.width||o.fontSize*1.5<a.height){o.fontSize++;i.font=o.getFontString()}}else if(s>a.width){while(i.measureText(t).width>a.width||o.fontSize*1.5>a.height){o.fontSize--;i.font=o.getFontString()}}return o.fontSize};e.CanvasTextProperties=function(t,e,a,r){this.setFontWeight(t);this.setFontStyle(e);this.setFontSize(a);this.fontFace=r?r:"sans-serif"};e.CanvasTextProperties.NORMAL="normal";e.CanvasTextProperties.BOLD="bold";e.CanvasTextProperties.BOLDER="bolder";e.CanvasTextProperties.LIGHTER="lighter";e.CanvasTextProperties.ITALIC="italic";e.CanvasTextProperties.OBLIQUE="oblique";e.CanvasTextProperties.prototype.setFontWeight=function(t){switch(t){case e.CanvasTextProperties.NORMAL:case e.CanvasTextProperties.BOLD:case e.CanvasTextProperties.BOLDER:case e.CanvasTextProperties.LIGHTER:this.fontWeight=t;break;default:this.fontWeight=e.CanvasTextProperties.NORMAL}};e.CanvasTextProperties.prototype.setFontStyle=function(t){switch(t){case e.CanvasTextProperties.NORMAL:case e.CanvasTextProperties.ITALIC:case e.CanvasTextProperties.OBLIQUE:this.fontStyle=t;break;default:this.fontStyle=e.CanvasTextProperties.NORMAL}};e.CanvasTextProperties.prototype.setFontSize=function(t){if(t&&t.indexOf&&t.indexOf("px")>-1){var e=t.split("px")[0];fontProperites.fontSize=isNaN(e)?24:e;return}this.fontSize=isNaN(t)?24:t};e.CanvasTextProperties.prototype.clone=function(){return new e.CanvasTextProperties(this.fontWeight,this.fontStyle,this.fontSize,this.fontFace)};e.CanvasTextProperties.prototype.getFontString=function(){return this.fontWeight+" "+this.fontStyle+" "+this.fontSize+"px "+this.fontFace}})(window);window.requestAnimationFrame=window.__requestAnimationFrame||window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(){return function(t,e){var a=e.__lastTime;if(a===undefined){a=0}var r=Date.now();var n=Math.max(1,33-(r-a));window.setTimeout(t,n);e.__lastTime=r+n}}();var readyStateCheckInterval=setInterval(function(){if(document.readyState==="complete"){clearInterval(readyStateCheckInterval);init()}},10);var canvas;var context;var canvasContainer;var htmlBounds;var bounds;var minimumStageWidth=300;var minimumStageHeight=300;var maxStageWidth=800;var maxStageHeight=1100;var resizeTimeoutId=-1;function init(){canvasContainer=document.getElementById("canvasContainer");window.onresize=resizeHandler;window.addEventListener("keydown",keyUpEventHandler,false);commitResize()}function getWidth(t){return Math.max(t.scrollWidth,t.offsetWidth,t.clientWidth)}function getHeight(t){return Math.max(t.scrollHeight,t.offsetHeight,t.clientHeight)}function resizeHandler(){context.clearRect(0,0,canvas.width,canvas.height);clearTimeout(resizeTimeoutId);clearTimeoutsAndIntervals();resizeTimeoutId=setTimeout(commitResize,300)}function commitResize(){if(canvas){canvasContainer.removeChild(canvas)}canvas=document.createElement("canvas");canvas.style.position="absolute";context=canvas.getContext("2d");canvasContainer.appendChild(canvas);htmlBounds=new Sakri.Geom.Rectangle(0,0,getWidth(canvasContainer),getHeight(canvasContainer));if(htmlBounds.width>=maxStageWidth){canvas.width=maxStageWidth;canvas.style.left=htmlBounds.getCenterX()-maxStageWidth/2+"px"}else{canvas.width=htmlBounds.width;canvas.style.left="0px"}if(htmlBounds.height>maxStageHeight){canvas.height=maxStageHeight;canvas.style.top=htmlBounds.getCenterY()-maxStageHeight/2+"px"}else{canvas.height=htmlBounds.height;canvas.style.top="0px"}bounds=new Sakri.Geom.Rectangle(0,0,canvas.width,canvas.height);context.clearRect(0,0,canvas.width,canvas.height);if(bounds.width<minimumStageWidth||bounds.height<minimumStageHeight){stageTooSmallHandler();return}var t=document.getElementById("textInputSpan");var e=(canvas.height-canvas.height*.85)/2+15;t.style.top=htmlBounds.getCenterY()+bounds.height/2-e+"px";t.style.left=htmlBounds.getCenterX()-getWidth(t)/2+"px";startDemo()}function stageTooSmallHandler(){var t="Sorry, bigger screen required :(";context.font="bold normal 24px sans-serif";context.fillText(t,bounds.getCenterX()-context.measureText(t).width/2,bounds.getCenterY()-12)}var HOME=0;var GAME=1;var GAME_OVER=2;var gameState;var scrollSpeed=3;var score;var fontProperties=new Sakri.CanvasTextProperties(Sakri.CanvasTextProperties.BOLD,null,100);var word="豪瑞李";function startDemo(){canvas.addEventListener("touchstart",handleUserTap,false);canvas.addEventListener("mousedown",handleUserTap,false);var t="FLAPPY TEXT";if(!logoCanvas){logoCanvas=document.createElement("canvas");logoCanvasBG=document.createElement("canvas")}createLogo("FLAPPY TEXT",logoCanvas,logoCanvasBG);if(!gameOverCanvas){gameOverCanvas=document.createElement("canvas");gameOverCanvasBG=document.createElement("canvas")}createLogo("GAME OVER",gameOverCanvas,gameOverCanvasBG);createGroundPattern();createBird();createTubes();createCityGraphic();score=0;gameState=HOME;loop()}function loop(){switch(gameState){case HOME:renderHome();break;case GAME:renderGame();break;case GAME_OVER:renderGameOver();break}}function handleUserTap(t){switch(gameState){case HOME:gameState=GAME;break;case GAME:birdYSpeed=-tapBoost;break;case GAME_OVER:commitResize();break}if(t){t.preventDefault()}}function keyUpEventHandler(t){if(t.keyCode==38){handleUserTap(t)}}function renderHome(){context.clearRect(0,0,canvas.width,canvas.height);renderGroundPattern();renderLogo();renderInstructions();window.requestAnimationFrame(loop,canvas)}function renderGame(){context.clearRect(0,0,canvas.width,canvas.height);updateTubes();renderTubes();updateBird();if(!characters.length){gameOverHandler();return}renderBird();renderGroundPattern();updateScore();renderScore();window.requestAnimationFrame(loop,canvas)}function gameOverHandler(){context.clearRect(0,0,canvas.width,canvas.height);gameState=GAME_OVER;renderGameOver()}function renderGameOver(){context.drawImage(gameOverCanvas,bounds.getCenterX()-logoCanvas.width/2,canvas.height*.2);var t="Click or tap to flap again.";context.font="bold normal 24px sans-serif";context.fillStyle="#FFFFFF";context.fillText(t,bounds.getCenterX()-context.measureText(t).width/2,canvas.height*.25+gameOverCanvas.height);renderScore()}function renderLogo(){logoCurrentY+=logoDirection;context.drawImage(logoCanvas,bounds.getCenterX()-logoCanvas.width/2,logoCurrentY);if(logoCurrentY<=logoY||logoCurrentY>=logoMaxY){logoDirection*=-1}}function renderInstructions(){var t="Click or tap to flap :)";context.font="bold normal 24px sans-serif";context.fillStyle="#FFFFFF";context.fillText(t,bounds.getCenterX()-context.measureText(t).width/2,canvas.height*.2)}function renderScore(){context.font=fontProperties.getFontString();context.fillStyle="#FFFFFF";context.strokeStyle="#000000";context.lineWidth=3;var t=bounds.getCenterX()-context.measureText(score).width/2;var e=bounds.height*.1;context.fillText(score,t,e);context.strokeText(score,t,e)}var logoCanvas;var logoCanvasBG;var gameOverCanvas;var gameOverCanvasBG;var logoY;var logoCurrentY;var logoMaxY;var logoDirection;function createLogo(t,e,a){e.width=logoCanvasBG.width=canvas.width;e.height=logoCanvasBG.height=canvas.height/4;logoCurrentY=logoY=canvas.height*.25;logoMaxY=canvas.height*.35;logoDirection=1;var r=e.getContext("2d");r.textBaseline="top";var n=new Sakri.Geom.Rectangle(0,0,e.width*.8,e.height);var i=fontProperties.clone();i.fontSize=Sakri.CanvasTextUtil.getFontSizeForRect(t,fontProperties,n);var o=logoCanvasBG.getContext("2d");o.fillStyle="#f5eea5";o.fillRect(0,0,logoCanvasBG.width,logoCanvasBG.height);o.fillStyle="#9ce358";o.fillRect(0,i.fontSize/2,logoCanvasBG.width,logoCanvasBG.height);r.font=i.getFontString();r.fillStyle=r.createPattern(logoCanvasBG,"repeat-x");r.strokeStyle="#000000";r.lineWidth=3;var s=e.width/2-r.measureText(t).width/2;var c=i.fontSize/2;r.fillText(t,s,0);r.strokeText(t,s,0)}var birdCanvas;var birdYSpeed=0;var gravity=1;var tapBoost=12;var birdSize=60;function updateBird(){characters[0].y+=birdYSpeed;birdYSpeed+=gravity;if(characters[0].y>=groundGraphicRect.y-birdCanvas.height){characters[0].y=groundGraphicRect.y-birdCanvas.height;birdYSpeed=0}if(characters[0].y<=0){characters[0].y=1;birdYSpeed=0}if(!isHit&&checkTubesCollision()){context.fillStyle="#FFFFFF";context.fillRect(0,0,canvas.width,canvas.height);removeCharacter();isHit=true}}var currentTube;var isHit=false;var ffScoreBugFix=0;function updateScore(){if(ffScoreBugFix>10&&currentTube.topRect.getRight()<characters[0].x){if(!isHit){score++}isHit=false;var t=tubes.indexOf(currentTube)+1;t%=tubes.length;currentTube=tubes[t];ffScoreBugFix=0}ffScoreBugFix++}function renderBird(){context.drawImage(characters[0].image,characters[0].x,characters[0].y);for(var t=1;t<characters.length;t++){characters[t].y=characters[t-1].y-(characters[t-1].y-characters[t].y)*.9;context.drawImage(characters[t].image,characters[t].x,characters[t].y)}}function removeCharacter(){if(characters.length==1){gameState=GAME_OVER}for(var t=0;t<characters.length-1;t++){characters[t].image=characters[t+1].image}characters.pop()}function checkTubesCollision(){for(var t=0;t<tubes.length;t++){if(checkTubeCollision(tubes[t])){return true}}return false}var collisionPoint=new Sakri.Geom.Point;var birdPoints=[];function checkTubeCollision(t){birdPoints[0]=characters[0].x;birdPoints[1]=characters[0].y;birdPoints[2]=characters[0].x+birdSize;birdPoints[3]=characters[0].y;birdPoints[4]=characters[0].x+birdSize;birdPoints[5]=characters[0].y+birdSize;birdPoints[6]=characters[0].x;birdPoints[7]=characters[0].y+birdSize;for(var e=0;e<8;e+=2){collisionPoint.x=birdPoints[e];collisionPoint.y=birdPoints[e+1];if(t.topRect.containsPoint(collisionPoint.x,collisionPoint.y)||t.bottomRect.containsPoint(collisionPoint.x,collisionPoint.y)){return true}}return false}var characters;var birdFontProperties=new Sakri.CanvasTextProperties(Sakri.CanvasTextProperties.BOLD,null,50);function createBird(){if(!birdCanvas){birdCanvas=document.createElement("canvas")}birdCanvas.width=birdSize;birdCanvas.height=birdSize;characters=[];characters[0]={};characters[0].x=canvas.width/3;characters[0].y=groundGraphicRect.y/2;characters[0].image=createCharacterImage(word.charAt(word.length-1));var t=characters[0].x-(birdCanvas.width+birdCanvas.width*.2);for(var e=1;e<word.length;e++){characters[e]={};characters[e].x=t;characters[e].y=characters[0].y;t-=birdCanvas.width+birdCanvas.width*.2;characters[e].image=createCharacterImage(word.charAt(word.length-e-1))}}function createCharacterImage(t){var e=birdCanvas.getContext("2d");e.textBaseline="top";e.font=birdFontProperties.getFontString();e.fillStyle="#d5bb22";e.fillRect(0,0,birdSize,birdSize/2);e.fillStyle="#e97b13";e.fillRect(0,birdSize/2,birdSize,birdSize/2);e.fillStyle="#e0e9a9";e.fillRect(0,0,birdSize,6);e.fillStyle="#da473b";e.fillRect(0,birdSize-10,birdSize,birdSize);e.lineWidth=3;e.strokeStyle="#4d2f3b";e.strokeRect(2,2,birdSize-4,birdSize-4);e.fillStyle="#e8fcd6";e.fillText(t,birdSize/2-e.measureText(t).width/2,0);e.strokeText(t,birdSize/2-e.measureText(t).width/2,0);var a=new Image;a.width=birdSize;a.height=birdSize;a.src=birdCanvas.toDataURL();return a}var tubeGapHeight=230;var tubesGapWidth;var tubes;var tubeWidth=100;var minTubeHeight=50;function updateTubes(){for(var t=0;t<tubes.length;t++){updateTube(tubes[t])}}function updateTube(t){t.topRect.x-=scrollSpeed;t.bottomRect.x=t.topRect.x;if(t.topRect.x<=-tubeWidth){t.topRect.x=t.bottomRect.x=canvas.width;renderTube(t)}}function renderTubes(){for(var t=0;t<tubes.length;t++){context.drawImage(tubes[t].canvas,tubes[t].bottomRect.x,0)}}function createTubes(){tubes=[];var t=2;tubesGapWidth=Math.floor(canvas.width/t);for(var e=0;e<t;e++){tubes[e]={};tubes[e].canvas=document.createElement("canvas");tubes[e].topRect=new Sakri.Geom.Rectangle(canvas.width+e*tubesGapWidth);tubes[e].bottomRect=new Sakri.Geom.Rectangle(canvas.width+e*tubesGapWidth);renderTube(tubes[e])}currentTube=tubes[0]}var tubeOutlineColor="#534130";var tubeMainColor="#75be2f";var tubeCapHeight=40;function renderTube(t){t.canvas.width=tubeWidth;t.canvas.height=groundGraphicRect.y;t.bottomRect.width=t.topRect.width=tubeWidth;t.topRect.y=0;t.topRect.height=minTubeHeight+Math.round(Math.random()*(groundGraphicRect.y-tubeGapHeight-minTubeHeight*2));t.bottomRect.y=t.topRect.getBottom()+tubeGapHeight;t.bottomRect.height=groundGraphicRect.y-t.bottomRect.y-1;var e=t.canvas.getContext("2d");e.lineWidth=2;renderTubeElement(e,3,0,tubeWidth-6,t.topRect.height);renderTubeElement(e,1,t.topRect.getBottom()-tubeCapHeight,tubeWidth-2,tubeCapHeight);renderTubeElement(e,3,t.bottomRect.y,tubeWidth-6,t.bottomRect.height);renderTubeElement(e,1,t.bottomRect.y,tubeWidth-2,tubeCapHeight)}function renderTubeElement(t,e,a,r,n){t.fillStyle=tubeMainColor;t.fillRect(e,a,r,n);t.fillStyle="#9de85a";t.fillRect(e,a,r*.25,n);t.fillStyle="#d9f881";t.fillRect(e+r*.05,a,r*.05,n);t.fillStyle="#547e25";t.fillRect(e+r-r*.1,a,r*.1,n);t.fillRect(e+r-r*.2,a,r*.05,n);t.strokeRect(e,a,r,n)}var cityGraphicCanvas;function createCityGraphic(){if(cityGraphicCanvas){canvasContainer.removeChild(cityGraphicCanvas)}cityGraphicCanvas=document.createElement("canvas");cityGraphicCanvas.style.position="absolute";cityGraphicCanvas.style.left=canvas.style.left;cityGraphicCanvas.style.top=canvas.style.top;cityGraphicCanvas.width=canvas.width;cityGraphicCanvas.height=canvas.height;var t=cityGraphicCanvas.getContext("2d");var e=canvas.height*.25;t.fillStyle="#71c5cf";t.fillRect(0,0,canvas.width,canvas.height);t.fillStyle="#e9fad8";t.save();t.translate(0,groundGraphicRect.y-e);var a=e*.4;var r=a*.5;for(iterator=0;iterator<canvas.width;iterator+=r){t.beginPath();t.arc(iterator,a,Sakri.MathUtil.getRandomNumberInRange(r,a),0,Sakri.MathUtil.PI2);t.closePath();t.fill()}t.fillRect(0,a,canvas.width,e);var n;var i;t.fillStyle="#deefcb";for(iterator=0;iterator<canvas.width;iterator+=n+8){n=20+Math.floor(Math.random()*30);i=Sakri.MathUtil.getRandomNumberInRange(e*.5,e-a*.8);t.fillRect(iterator,e-i,n,i)}t.fillStyle="#dff1c4";t.strokeStyle="#9fd5d5";t.lineWidth=3;for(iterator=0;iterator<canvas.width;iterator+=n+8){n=20+Math.floor(Math.random()*30);i=Sakri.MathUtil.getRandomNumberInRange(e*.5,e-a*.8);t.fillRect(iterator,e-i,n,i);t.strokeRect(iterator,e-i,n,i)}var o=e*.3;var s=o*.5;var c;var l=Math.PI+Math.PI/4;var h=Math.PI+Math.PI/4;t.fillStyle="#81e18b";t.strokeStyle="#72c887";for(iterator=0;iterator<canvas.width;iterator+=s){t.beginPath();c=Sakri.MathUtil.getRandomNumberInRange(r,a);t.arc(iterator,e,c,0,Sakri.MathUtil.PI2);t.closePath();t.fill();t.beginPath();t.arc(iterator,e,c,l,h);t.closePath();t.stroke()}t.restore();t.fillStyle=sand;t.fillRect(0,groundGraphicRect.y,canvas.width,canvas.height);canvasContainer.insertBefore(cityGraphicCanvas,canvasContainer.firstChild)}var groundX=0;function renderGroundPattern(){context.drawImage(groundPatternCanvas,groundX,groundGraphicRect.y);groundX-=scrollSpeed;groundX%=16}var groundLightGreen="#97e556";var groundDarkGreen="#73be29";var groundDarkerGreen="#4b7e19";var groundShadow="#d1a649";var groundBorder="#4c3f48";var sand="#dcd795";var groundGraphicRect=new Sakri.Geom.Rectangle;var groundPatternCanvas;function createGroundPattern(){groundGraphicRect.y=canvas.height*.85;if(!groundPatternCanvas){groundPatternCanvas=document.createElement("canvas")}groundPatternCanvas.width=16;groundPatternCanvas.height=16;var t=groundPatternCanvas.getContext("2d");t.fillStyle=groundLightGreen;t.fillRect(0,0,16,16);t.fillStyle=groundDarkGreen;t.beginPath();t.moveTo(8,3);t.lineTo(16,3);t.lineTo(8,13);t.lineTo(0,13);t.closePath();t.fill();t.fillStyle=groundBorder;t.globalAlpha=.2;t.fillRect(0,0,16,1);t.globalAlpha=1;t.fillRect(0,1,16,1);t.globalAlpha=.6;t.fillRect(0,2,16,1);t.fillStyle="#FFFFFF";t.globalAlpha=.3;t.fillRect(0,3,16,2);t.fillStyle=groundDarkerGreen;t.globalAlpha=.3;t.fillRect(0,10,16,3);t.globalAlpha=1;t.fillRect(0,11,16,1);t.fillStyle=groundShadow;t.fillRect(0,13,16,3);var e=context.createPattern(groundPatternCanvas,"repeat-x");groundPatternCanvas.width=canvas.width+16;groundPatternCanvas.height=16;t.fillStyle=e;t.fillRect(0,0,groundPatternCanvas.width,16)}function clearTimeoutsAndIntervals(){gameState=-1}var maxCharacters=8;function changeText(){var t=document.getElementById("textInput");if(t.value&&t.text!=""){if(t.value.length>maxCharacters){alert("Sorry, there is only room for "+maxCharacters+" characters. Try a shorter name.");return}if(t.value.indexOf(" ")>-1){alert("Sorry, no support for spaces right now :(");return}word=t.value;clearTimeoutsAndIntervals();animating=false;setTimeout(commitResize,100)}}